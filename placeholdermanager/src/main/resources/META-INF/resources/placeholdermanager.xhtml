<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
		"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:h="http://java.sun.com/jsf/html"
	  xmlns:p="http://primefaces.org/ui"
	  xmlns:ui="http://java.sun.com/jsf/facelets"
	  xmlns:f="http://java.sun.com/jsf/core"
>

<h:head>
</h:head>

<h:body style="margin-left:50px">
	
	
	<script type="text/javascript">
		function handleDrop(event, ui) {
			var droppredKey = ui.draggable;
			
		}
	</script>
    
	<p:panel id="panelApp">
		<f:facet name="header">
			<h:panelGrid columns="3">
				<p:graphicImage name="LOGO_ITS4U_Group_Interstate_COLOR.png"  style="background: transparent;width:200px;margin-right:20px;"/>
				
				<p:outputLabel value="OCP - GitOps Application Deployer"   style="width:100%;text-align: center;font-size: 40px;color:#003b50"></p:outputLabel>
				
			</h:panelGrid>			
		</f:facet>
   		<h:form id="form" prependId="false">
   		<p:growl id="growl" showDetail="true" />
   		<div style="position:relative;margin:auto;text-align:center;">	
	   		<p:commandButton value="Refresh"  actionListener="#{placeHoldersView.refresh}" update="@form" style="margin:10px;background:#003b50;color:white" />
	   		<p:commandButton value="Logs" onclick="PF('dlg1').show()"/>
	   		<p:commandButton value="Save Configuration"  actionListener="#{placeHoldersView.save}" 
	   			oncomplete="PF('dlg0').hide()"
	   			onclick="PF('dlg0').show()" update="growl" style="margin:10px;background:#003b50;color:white" />
   		</div>
   		
   		<p:poll interval="4" listener="#{placeHoldersView.refreshStatusProject}" update="syncstatus,healthstatus"/>
   		
	 			<h:panelGrid columns="2">
	 				<h:outputText value="My projects :"/>
	 				 <p:selectOneMenu  value="#{placeHoldersView.selectedProjectId}"
	 				 	 onchange="PF('dlg0').show()">
	 				 	 	<f:selectItem itemLabel="Select One" itemValue=""/>
	                  	<f:selectItems value="#{placeHoldersView.myProjects}" var="project" itemLabel="#{project}" itemValue="#{project}"/>
	                  	<p:ajax  oncomplete="PF('dlg0').hide()"  event="change" update="tabviewenv,giturl,growl,syncstatus,healthstatus" listener="#{placeHoldersView.onSelectedProject(placeHoldersView.selectedProjectId)}" />
	                  	
	 				 </p:selectOneMenu>
	 				 <h:outputText value="Git url"/>
	 				 <h:outputText id="giturl" value="#{placeHoldersView.selectedProject.gitUrl}"/>
	 				 
	 				 <h:outputText value="Sync"/>
	 				 <h:outputText id="syncstatus" value="#{placeHoldersView.appStatus.sync}"/>
	 				 
	 				 <h:outputText value="Health"/>
	 				 <h:outputText id="healthstatus" value="#{placeHoldersView.appStatus.health}"/>
	   			</h:panelGrid>
	   			
   			
   			
		   			<p:tabView value="#{placeHoldersView.selectedProject.environments}" var="env" id="tabviewenv" >
					    	<p:tab title="#{env.environment}" >
					    			<div style="position:relative;margin:auto;text-align:center;">	
					    				<p:commandButton value="Apply And Deploy Configuration" 
					    					oncomplete="PF('dlg0').hide()"
	   										onclick="PF('dlg0').show()"
					    				 actionListener="#{placeHoldersView.synchronise(env.projectId)}" update="growl" style="margin:10px;background:#003b50;color:white" />
			   		
			   							<p:commandButton value="UnDeploy Configuration"  actionListener="#{placeHoldersView.refresh}" update="@form" style="margin:10px;background:#003b50;color:white" />
			   		
			   							<p:commandButton value="Rollback"  actionListener="#{placeHoldersView.refresh}" update="@form" style="margin:10px;background:#003b50;color:white" />
			   							
			   							<p:commandButton value="Status"  actionListener="#{argoInitializerBean.statusAndHealth(env.projectId)}" update="@form" style="margin:10px;background:#003b50;color:white" />
			   						</div>
					    			<b>Clear Values :</b>
					    			<p:dataTable value="#{env.clearPlaceholders}"  var="entry"  widgetVar="placeHolderTable">
					    				<p:column  headerText="Key">	
									        		<h:outputText value="#{entry.placeHolderId.key}"/>
										</p:column>		
										<p:column  headerText="Value">	
									        		<p:inputText value="#{entry.value}" style="width:600px;"/>
										</p:column>		
										
										
					    			</p:dataTable>
					    			<br/>
					    			<b>Encrypted Values :</b>
					    			<p:dataTable value="#{env.secretsPlaceholders}"  var="entry"  widgetVar="placeHolderTable">
					    				<p:column  headerText="Key">	
									        		<h:outputText value="#{entry.placeHolderId.key}" />
										</p:column>		
										<p:column  headerText="Value">	
									        		<p:password  value="#{entry.value}" toggleMask="true" redisplay="true" style="width:400px;"/>
										</p:column>									
					    			</p:dataTable>
					    			<br/>
					    			<b>New placeHolders detected :</b>
					    			<p:dataTable value="#{env.newPlaceholders}"  var="entry"  widgetVar="placeHolderTable">
					    				<p:column  headerText="Key">	
									        		<h:outputText value="#{entry.placeHolderId.key}" />
										</p:column>		
										<p:column  headerText="Action">	
									        	
									        		<p:commandButton value="Add as Clear value"  
									        			actionListener="#{placeHoldersView.addNewPlaceHolder(env,entry,false)}"
									        			update="@form" style="margin:10px;background:#003b50;color:white" />
			   										
			   										<p:commandButton value="Add as Secret value"  
			   											actionListener="#{placeHoldersView.addNewPlaceHolder(env,entry,true)}"
			   											update="@form" style="margin:10px;background:#003b50;color:white" />
									        	
										</p:column>									
					    			</p:dataTable>
					    	</p:tab>
					</p:tabView>
					
				
    	</h:form>
	</p:panel>
	
	<p:dialog header="Logs" widgetVar="dlg1" minHeight="500" width="1400" showEffect="fade">
		<h:form>
			<h:outputText escape="false"  id="txt_count" value="#{pollView.listLogs}"/>									
			<p:poll interval="1" listener="#{pollView.increment}" update="txt_count"/>
		</h:form>	
	</p:dialog>
 
 	<p:dialog  widgetVar="dlg0"  showEffect="fade">
		<h:form>
			<p:graphicImage name="loader_seq.gif"  style="background: transparent;"/>
		</h:form>	
	</p:dialog>
 
</h:body>
</html>
